<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tech Turf - Identity Initiation</title>

  <!-- External Libraries -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Our New Centralized Files -->
  <link rel="stylesheet" href="/src/css/pages/style.css">
  <script src="/src/js/core/layout.js" defer></script>

  <style>
    body {
      background-color: #000;
      overflow: hidden;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    /* 3D Container */
    #canvas-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      background: radial-gradient(circle at center, #0a0a1a 0%, #000000 100%);
    }

    .auth-container {
      position: relative;
      z-index: 10;
      width: 100%;
      max-width: 440px;
      padding: 24px;
      perspective: 2000px;
    }

    .auth-card {
      padding: 48px;
      transform-style: preserve-3d;
      transition: transform 0.6s var(--transition-curve);
    }

    .input-group {
      position: relative;
      margin-bottom: 24px;
    }

    .input-group input {
      width: 100%;
      padding: 16px 24px;
      padding-right: 56px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 1.25rem;
      color: white;
      font-size: 15px;
      transition: all 0.4s var(--transition-curve);
      outline: none;
      letter-spacing: 0.5px;
    }

    .input-group input:focus {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .input-group i,
    .input-group svg {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      color: rgba(255, 255, 255, 0.3);
      pointer-events: none;
      transition: all 0.4s var(--transition-curve);
      z-index: 20;
    }

    .input-group input:focus~i,
    .input-group input:focus~svg {
      color: white;
      transform: translateY(-50%) scale(1.1);
    }

    .auth-btn {
      width: 100%;
      padding: 18px;
      background: white;
      color: black;
      border-radius: 1.25rem;
      font-weight: 800;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.4s var(--transition-curve);
      text-transform: uppercase;
      letter-spacing: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      border: none;
    }

    .auth-btn:hover {
      transform: translateY(-3px);
      background: #f8fafc;
      box-shadow: 0 15px 30px rgba(255, 255, 255, 0.1);
    }

    .auth-btn:active {
      transform: translateY(-1px);
    }

    .title-gradient {
      font-size: 2.5rem;
      font-weight: 950;
      text-align: center;
      margin-bottom: 4px;
      color: white;
      letter-spacing: -2px;
      line-height: 1;
    }

    .status-badge {
      display: inline-block;
      padding: 6px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.5);
      font-size: 10px;
      font-weight: 800;
      border-radius: 9999px;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 32px;
    }
  </style>
</head>

<body>
  <!-- 3D Canvas Background -->
  <div id="canvas-container"></div>

  <!-- Registration Form -->
  <div class="auth-container">
    <div class="auth-card tilt-element text-center iphone-glass rounded-[3.5rem] border border-white/5 shadow-3xl">
      <div
        class="inline-flex items-center gap-3 px-5 py-2.5 rounded-full border border-white/10 iphone-glass text-white/50 text-[9px] font-black tracking-[0.3em] mb-12 animate-float uppercase">
        <span class="w-1.5 h-1.5 rounded-full bg-blue-500 animate-ping"></span>
        Identity Initiation Protocol
      </div>

      <h1 class="text-6xl md:text-7xl font-black tracking-tighter text-white uppercase leading-none mb-4">
        New<br><span class="text-white/20">Identity</span>
      </h1>
      <p class="text-white/40 text-center mb-16 text-[10px] font-black tracking-[0.4em] uppercase mt-4">
        Biometric Sync & Data Relay
      </p>

      <form id="register-form" class="space-y-6">
        <div class="input-group">
          <input type="text" id="username" required placeholder="Display Name / Alias" autocomplete="off"
            class="glass-input w-full px-8 py-5 bg-white/5 border border-white/10 rounded-2xl text-white outline-none focus:border-white/30 transition-all text-sm font-medium">
          <i data-lucide="user" class="absolute-icon"></i>
        </div>

        <div class="input-group">
          <input type="email" id="email" required placeholder="Communication Channel (Email)" autocomplete="off"
            class="glass-input w-full px-8 py-5 bg-white/5 border border-white/10 rounded-2xl text-white outline-none focus:border-white/30 transition-all text-sm font-medium">
          <i data-lucide="mail" class="absolute-icon"></i>
        </div>

        <div class="input-group">
          <input type="password" id="password" required placeholder="Security Key (Min 8 chars)" minlength="8"
            class="glass-input w-full px-8 py-5 bg-white/5 border border-white/10 rounded-2xl text-white outline-none focus:border-white/30 transition-all text-sm font-medium">
          <i data-lucide="lock" class="absolute-icon"></i>
        </div>

        <div class="flex justify-between items-center py-4 text-sm px-2">
          <a href="login.html"
            class="text-[10px] text-orange-500 hover:text-orange-400 transition-colors font-black uppercase tracking-widest">Existing
            Identity?</a>
          <span class="text-[10px] text-white/10 uppercase tracking-widest font-black">Secure Relay</span>
        </div>

        <button type="submit" id="register-button"
          class="magnetic-btn w-full bg-white text-black py-6 text-[11px] rounded-2xl font-black uppercase tracking-[0.3em] hover:bg-gray-200 transition-all shadow-2xl shadow-white/5 mt-8 flex items-center justify-center gap-4">
          <span>Finalize Protocol</span>
          <i data-lucide="shield-check" class="w-4 h-4"></i>
        </button>
      </form>
    </div>
  </div>

  <div id="message-container"></div>

  <script>
    // --- 3D Background Logic ---
    const container = document.getElementById('canvas-container');
    const scene = new THREE.Scene();
    scene.fog = new THREE.FogExp2(0x050510, 0.001);

    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 3000);
    camera.position.z = 1000;

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    container.appendChild(renderer.domElement);

    function getTexture() {
      const canvas = document.createElement('canvas');
      canvas.width = 32; canvas.height = 32;
      const context = canvas.getContext('2d');
      const gradient = context.createRadialGradient(16, 16, 0, 16, 16, 16);
      gradient.addColorStop(0, 'rgba(255,255,255,1)');
      gradient.addColorStop(0.2, 'rgba(255,255,255,0.8)');
      gradient.addColorStop(0.5, 'rgba(255,255,255,0.2)');
      gradient.addColorStop(1, 'rgba(0,0,0,0)');
      context.fillStyle = gradient; context.fillRect(0, 0, 32, 32);
      const texture = new THREE.Texture(canvas); texture.needsUpdate = true; return texture;
    }
    const particleTexture = getTexture();

    const starGeo = new THREE.BufferGeometry();
    const starCount = 6000; const starPos = [];
    for (let i = 0; i < starCount; i++) { starPos.push((Math.random() - 0.5) * 3000, (Math.random() - 0.5) * 3000, (Math.random() - 0.5) * 3000); }
    starGeo.setAttribute('position', new THREE.Float32BufferAttribute(starPos, 3));
    const stars = new THREE.Points(starGeo, new THREE.PointsMaterial({ color: 0xffffff, size: 1.5, sizeAttenuation: false, transparent: true, opacity: 0.8 }));
    scene.add(stars);

    const dustGeo = new THREE.BufferGeometry();
    const dustCount = 2000; const dustPos = []; const dustColors = [];
    const colorPalette = [new THREE.Color('#ea580c'), new THREE.Color('#3b82f6'), new THREE.Color('#ffffff')];
    for (let i = 0; i < dustCount; i++) {
      dustPos.push((Math.random() - 0.5) * 2500, (Math.random() - 0.5) * 2500, (Math.random() - 0.5) * 2500);
      const color = colorPalette[Math.floor(Math.random() * colorPalette.length)];
      dustColors.push(color.r, color.g, color.b);
    }
    dustGeo.setAttribute('position', new THREE.Float32BufferAttribute(dustPos, 3));
    dustGeo.setAttribute('color', new THREE.Float32BufferAttribute(dustColors, 3));
    const dust = new THREE.Points(dustGeo, new THREE.PointsMaterial({ size: 4, map: particleTexture, vertexColors: true, transparent: true, opacity: 0.6, depthWrite: false, blending: THREE.AdditiveBlending }));
    scene.add(dust);

    let mouseX = 0, mouseY = 0;
    document.addEventListener('mousemove', (e) => {
      mouseX = (e.clientX - window.innerWidth / 2); mouseY = (e.clientY - window.innerHeight / 2);
      const card = document.querySelector('.tilt-element');
      if (card) {
        const xAxis = (window.innerWidth / 2 - e.pageX) / 40;
        const yAxis = (window.innerHeight / 2 - e.pageY) / 40;
        card.style.transform = `rotateY(${xAxis}deg) rotateX(${yAxis}deg)`;
      }
    });

    function animate() {
      requestAnimationFrame(animate);
      stars.rotation.y += 0.0001; dust.rotation.y += 0.0003;
      camera.position.x += (mouseX * 0.2 - camera.position.x) * 0.02;
      camera.position.y += (-mouseY * 0.2 - camera.position.y) * 0.02;
      camera.lookAt(scene.position); renderer.render(scene, camera);
    }
    animate();

    window.addEventListener('resize', () => { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });

    // Registration Logic
    function checkRegistrationLogic() {
      const registerForm = document.getElementById('register-form');
      const registerButton = document.getElementById('register-button');
      const btnText = registerButton.querySelector('span');

      // 1. Safety Check for dependencies
      if (typeof window.showMessage !== 'function' || typeof window.API_BASE_URL === 'undefined') {
        console.warn('Registration: Layout dependencies missing, using fallbacks');
        window.API_BASE_URL = window.location.protocol === 'file:' ? 'http://localhost:5000/api' : '/api';
        window.showMessage = (type, msg) => alert(`${type.toUpperCase()}: ${msg}`);
        window.isLoggedIn = () => !!localStorage.getItem('tt_token');
      }

      if (window.isLoggedIn()) { window.location.href = 'index.html'; return; }

      registerForm.addEventListener('submit', async function (e) {
        e.preventDefault();
        const username = document.getElementById('username').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;

        if (password.length < 8) { window.showMessage('error', 'Key must be at least 8 characters.'); return; }

        registerButton.disabled = true; btnText.textContent = 'Initializing...';

        try {
          const response = await fetch(`${window.API_BASE_URL}/auth/register`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, email, password }),
          });

          let data;
          try {
            data = await response.json();
          } catch (e) {
            throw new Error('Invalid response from server (System Hub Relay Error)');
          }

          if (response.ok) {
            window.showMessage('success', 'Identity Created! Granting Access...');
            localStorage.setItem('tt_token', data.token);
            localStorage.setItem('tt_user', JSON.stringify(data.user));
            setTimeout(() => { window.location.href = 'index.html'; }, 1500);
          } else {
            window.showMessage('error', data.message || 'Initiation Failed: Protocol Error');
            registerButton.disabled = false; btnText.textContent = 'Finalize Protocol';
          }
        } catch (err) {
          console.error('Registration Error:', err);
          let errorMsg = 'System Hub Offline (Connection Timeout)';
          if (err.message.includes('Relay Error')) errorMsg = err.message;
          window.showMessage('error', errorMsg);
          registerButton.disabled = false; btnText.textContent = 'Finalize Protocol';
        }
      });
    }
    window.addEventListener('load', () => { checkRegistrationLogic(); lucide.createIcons(); });
  </script>
</body>

</html>