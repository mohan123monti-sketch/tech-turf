<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tech Turf - Compare Products</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="/src/css/pages/style.css">
    <link rel="stylesheet" href="/src/css/pages/shop-styles.css">
    <script src="/src/js/features/shop-logic.js"></script>
    <script src="/src/js/core/layout.js" defer></script>
</head>

<body data-page="Compare" class="shop-branding">
    <div id="header-container"></div>

    <main class="relative z-10 py-28 px-4 min-h-screen">
        <div class="max-w-6xl mx-auto">
            <header class="mb-10 reveal-hidden">
                <h1 class="text-4xl md:text-6xl font-black tracking-tighter text-white uppercase leading-none">Compare</h1>
                <p class="text-[10px] font-black tracking-[0.4em] uppercase text-white/40 mt-3">Side-by-side specs</p>
            </header>

            <div id="compare-grid" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
        </div>
    </main>

    <div id="footer-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const grid = document.getElementById('compare-grid');
            const params = new URLSearchParams(window.location.search);
            const ids = params.get('ids') ? params.get('ids').split(',').filter(Boolean) : [];

            if (ids.length === 0) {
                grid.innerHTML = '<p class="text-white/40">No products selected for comparison.</p>';
                return;
            }

            const products = await window.fetchProducts();
            const compareItems = products.filter(p => ids.includes(String(p._id || p.id)));

            if (compareItems.length === 0) {
                grid.innerHTML = '<p class="text-white/40">No products found.</p>';
                return;
            }

            const renderCard = (product) => {
                const stock = Number(product.stock || product.countInStock || 0);
                return `
                    <div class="bg-white/5 border border-white/10 rounded-3xl overflow-hidden">
                        <div class="aspect-square bg-black/20">
                            <img src="${product.imageUrl || (product.images && product.images[0]) || 'https://via.placeholder.com/300'}" alt="${product.name}" class="w-full h-full object-cover">
                        </div>
                        <div class="p-6 space-y-3">
                            <h3 class="text-xl font-black text-white">${product.name}</h3>
                            <p class="text-[#d2670e] font-mono font-bold">â‚¹${product.price}</p>
                            <p class="text-xs text-white/50">Brand: ${product.brand || 'Tech Turf'}</p>
                            <p class="text-xs text-white/50">ETA: ${Number(product.deliveryEtaDays || 3)} days</p>
                            <p class="text-xs text-white/50">Rating: ${(Number(product.ratingAvg || 0)).toFixed(1)} (${Number(product.ratingCount || 0)} reviews)</p>
                            <p class="text-xs text-white/50">Stock: ${stock > 0 ? stock : 'Out of Stock'}</p>
                            <button class="w-full mt-3 px-4 py-2 rounded-xl text-xs font-black uppercase tracking-widest ${stock > 0 ? 'bg-[#d2670e] text-white hover:bg-[#b0550b]' : 'bg-white/10 text-white/40 cursor-not-allowed'}" ${stock > 0 ? '' : 'disabled'} onclick="window.addToCart(${JSON.stringify(product).replace(/"/g, '&quot;')})">
                                ${stock > 0 ? 'Add to Cart' : 'Out of Stock'}
                            </button>
                        </div>
                    </div>
                `;
            };

            grid.innerHTML = compareItems.map(renderCard).join('');
            if (window.lucide) lucide.createIcons();
        });
    </script>
</body>

</html>
