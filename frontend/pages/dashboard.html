<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tech Turf - Mission Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="/src/css/pages/style.css">
    <script src="/src/js/core/layout.js" defer></script>
    <style>
        .iphone-glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-20px);
            }
        }
    </style>
</head>

<body data-page="Dashboard" data-3d-enabled="true">
    <div id="header-container"></div>

    <main class="relative z-10 py-32 px-4 min-h-screen">
        <div class="max-w-7xl mx-auto">
            <header class="mb-16 reveal-hidden">
                <h1 class="text-5xl md:text-7xl font-black tracking-tighter text-white uppercase leading-none">
                    Mission<br><span class="text-white/20">Control</span>
                </h1>
                <p class="text-[10px] font-black tracking-[0.4em] uppercase text-white/40 mt-4">Operational Status:
                    Online</p>
            </header>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
                <!-- User Profile Card -->
                <div class="iphone-glass p-8 rounded-[2.5rem] border border-white/5 shadow-2xl reveal-hidden">
                    <div class="flex items-center gap-6 mb-8">
                        <div
                            class="w-16 h-16 rounded-2xl bg-orange-500/20 flex items-center justify-center border border-orange-500/30">
                            <i data-lucide="user" class="text-orange-500"></i>
                        </div>
                        <div>
                            <h3 id="dash-username" class="text-2xl font-black text-white uppercase tracking-tighter">
                                Pilot</h3>
                            <p id="dash-email" class="text-xs text-white/30 font-medium">Authenticating...</p>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <a href="account.html"
                            class="block w-full text-center py-4 iphone-glass rounded-xl text-[10px] font-black uppercase tracking-widest text-white/70 hover:text-white transition-all">Edit
                            ID Profile</a>
                    </div>
                </div>

                <!-- Stats Card -->
                <div class="iphone-glass p-8 rounded-[2.5rem] border border-white/5 shadow-2xl reveal-hidden"
                    style="transition-delay: 0.1s;">
                    <div class="flex items-center gap-6 mb-8">
                        <div
                            class="w-16 h-16 rounded-2xl bg-blue-500/20 flex items-center justify-center border border-blue-500/30">
                            <i data-lucide="package" class="text-blue-500"></i>
                        </div>
                        <div>
                            <h3 id="order-count" class="text-4xl font-black text-white uppercase tracking-tighter">00
                            </h3>
                            <p class="text-[10px] text-white/30 font-black uppercase tracking-widest">Completed Missions
                            </p>
                        </div>
                    </div>
                    <a href="orders.html"
                        class="block w-full text-center py-4 iphone-glass rounded-xl text-[10px] font-black uppercase tracking-widest text-white/70 hover:text-white transition-all">View
                        All Logs</a>
                </div>

                <!-- Loyalty/Rank Card -->
                <div class="iphone-glass p-8 rounded-[2.5rem] border border-white/5 shadow-2xl reveal-hidden"
                    style="transition-delay: 0.2s;">
                    <div class="flex items-center gap-6 mb-8">
                        <div
                            class="w-16 h-16 rounded-2xl bg-purple-500/20 flex items-center justify-center border border-purple-500/30">
                            <i data-lucide="award" class="text-purple-500"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-black text-white uppercase tracking-tighter">Rank: Nova</h3>
                            <p class="text-[10px] text-white/30 font-black uppercase tracking-widest">Early Access
                                Member</p>
                        </div>
                    </div>
                    <div class="w-full bg-white/5 h-2 rounded-full overflow-hidden">
                        <div class="bg-purple-500 h-full w-[65%]"></div>
                    </div>
                    <p class="text-[8px] text-white/20 mt-3 uppercase tracking-widest font-black">35% until Supernova
                        Rank</p>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="iphone-glass p-12 rounded-[3.5rem] border border-white/5 shadow-3xl reveal-hidden"
                style="transition-delay: 0.3s;">
                <h2 class="text-3xl font-black text-white uppercase tracking-tighter mb-12">Recent Fleet Activity</h2>
                <div id="recent-orders" class="space-y-6">
                    <!-- Orders injected here -->
                    <div class="text-center py-20 text-white/10 uppercase tracking-[0.3em] font-black text-xs">
                        Synchronizing with Hub...
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="footer-container"></div>

    <script type="module">
        import { getProfile } from './js/auth.js';
        import { getMyOrders } from './js/orders.js';

        async function initDashboard() {
            try {
                const user = await getProfile();
                if (!user) {
                    window.location.href = 'login.html';
                    return;
                }

                document.getElementById('dash-username').textContent = user.username;
                document.getElementById('dash-email').textContent = user.email;

                const orders = await getMyOrders();
                document.getElementById('order-count').textContent = orders.length.toString().padStart(2, '0');

                const recentContainer = document.getElementById('recent-orders');
                recentContainer.innerHTML = '';

                if (orders.length === 0) {
                    recentContainer.innerHTML = '<p class="text-white/20 text-center py-8">No recent missions logged.</p>';
                    return;
                }

                orders.slice(0, 3).forEach(order => {
                    const rawStatus = order.status || (order.isDelivered ? 'Delivered' : 'Processing');
                    const statusMap = {
                        Pending: 'Pending',
                        Processing: 'Processing',
                        Shipped: 'Shipped',
                        Delivered: 'Delivered',
                        Cancelled: 'Cancelled'
                    };
                    const statusColors = {
                        Pending: 'bg-yellow-500/10 text-yellow-400',
                        Processing: 'bg-orange-500/10 text-orange-400',
                        Shipped: 'bg-blue-500/10 text-blue-400',
                        Delivered: 'bg-green-500/10 text-green-400',
                        Cancelled: 'bg-red-500/10 text-red-400'
                    };
                    const displayStatus = statusMap[rawStatus] || rawStatus;
                    const statusClass = statusColors[rawStatus] || 'bg-orange-500/10 text-orange-400';
                    const div = document.createElement('div');
                    div.className = 'flex items-center justify-between p-6 iphone-glass rounded-2xl border border-white/5 hover:bg-white/5 transition-all';
                    div.innerHTML = `
                        <div class="flex items-center gap-6">
                            <div class="w-12 h-12 rounded-xl bg-white/5 flex items-center justify-center">
                                <i data-lucide="box" class="text-white/40 w-5 h-5"></i>
                            </div>
                            <div>
                                <h4 class="text-white font-bold tracking-widest uppercase text-sm">Order #${order._id.slice(-6)}</h4>
                                <p class="text-[9px] text-white/30 font-black uppercase tracking-widest">${new Date(order.createdAt).toLocaleDateString()}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-white font-black tracking-tighter">â‚¹${order.totalPrice.toFixed(2)}</p>
                            <span class="text-[8px] font-black tracking-widest px-3 py-1 rounded-full ${statusClass} uppercase mt-2 inline-block">
                                ${displayStatus}
                            </span>
                        </div>
                    `;
                    recentContainer.appendChild(div);
                });

                if (window.lucide) lucide.createIcons();
                if (window.handleScrollReveal) window.handleScrollReveal();

            } catch (err) {
                console.error(err);
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            initDashboard();
            setInterval(initDashboard, 30000);
        });

        window.addEventListener('orderUpdated', () => {
            initDashboard();
        });
    </script>
</body>

</html>