<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tech Turf - Identity Initiation</title>

  <!-- External Libraries -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Our New Centralized Files -->
  <link rel="stylesheet" href="style.css">
  <script src="layout.js" defer></script>

  <style>
    body {
      background-color: #000;
      overflow: hidden;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    /* 3D Container */
    #canvas-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      background: radial-gradient(circle at center, #0a0a1a 0%, #000000 100%);
    }

    .auth-container {
      position: relative;
      z-index: 10;
      width: 100%;
      max-width: 450px;
      padding: 20px;
      perspective: 1000px;
    }

    .auth-card {
      background: rgba(15, 23, 42, 0.4);
      backdrop-filter: blur(20px) saturate(150%);
      -webkit-backdrop-filter: blur(20px) saturate(150%);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-top: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 2rem;
      padding: 40px;
      box-shadow:
        0 25px 50px -12px rgba(0, 0, 0, 0.7),
        inset 0 0 20px rgba(255, 255, 255, 0.02);
      transform-style: preserve-3d;
      transition: transform 0.1s;
    }

    .input-group {
      position: relative;
      margin-bottom: 20px;
    }

    .input-group input {
      width: 100%;
      padding: 16px 45px 16px 20px;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 1rem;
      color: white;
      font-size: 15px;
      transition: all 0.3s var(--transition-curve);
      outline: none;
      letter-spacing: 0.5px;
    }

    .input-group input:focus {
      border-color: var(--primary);
      background: rgba(0, 0, 0, 0.6);
      box-shadow: 0 0 20px rgba(234, 88, 12, 0.15);
      transform: translateY(-2px);
    }

    .input-group i,
    .input-group svg {
      position: absolute;
      right: 18px;
      top: 50%;
      transform: translateY(-50%);
      color: #9ca3af;
      pointer-events: none;
      transition: color 0.3s;
      z-index: 20;
    }

    .input-group input:focus~i,
    .input-group input:focus~svg {
      color: var(--primary);
    }

    .auth-btn {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #ea580c 0%, #c2410c 100%);
      color: white;
      border: none;
      border-radius: 1rem;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.3s var(--transition-curve);
      text-transform: uppercase;
      letter-spacing: 1.5px;
      box-shadow: 0 4px 15px rgba(234, 88, 12, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .auth-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(234, 88, 12, 0.5);
      filter: brightness(1.1);
    }

    .auth-btn:active {
      transform: translateY(0);
    }

    .title-gradient {
      font-size: 1.75rem;
      font-weight: 900;
      text-align: center;
      margin-bottom: 8px;
      background: linear-gradient(to bottom, #ffffff, #94a3b8);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: -1px;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      background: rgba(234, 88, 12, 0.1);
      border: 1px solid rgba(234, 88, 12, 0.2);
      color: var(--primary);
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.65rem;
      border-radius: 9999px;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 20px;
    }
  </style>
</head>

<body>
  <!-- 3D Canvas Background -->
  <div id="canvas-container"></div>

  <!-- Registration Form -->
  <div class="auth-container">
    <div class="auth-card tilt-element text-center">
      <div class="status-badge">Identity Protocol: New User Initiation</div>

      <h1 class="title-gradient">CREATE IDENTITY</h1>
      <p class="text-gray-400 text-center mb-10 text-xs font-mono tracking-widest uppercase opacity-70">
        Join the Tech Turf Ecosystem</p>

      <form id="register-form">
        <div class="input-group">
          <input type="text" id="username" required placeholder="Display Name / Alias" autocomplete="off">
          <i data-lucide="user" class="absolute-icon"></i>
        </div>

        <div class="input-group">
          <input type="email" id="email" required placeholder="Communication Channel (Email)" autocomplete="off">
          <i data-lucide="mail" class="absolute-icon"></i>
        </div>

        <div class="input-group">
          <input type="password" id="password" required placeholder="Security Key (Min 8 characters)" minlength="8">
          <i data-lucide="lock" class="absolute-icon"></i>
        </div>

        <div class="flex justify-between items-center mb-6 text-sm px-1">
          <a href="login.html"
            class="text-xs text-orange-500 hover:text-orange-400 transition-colors font-bold uppercase tracking-wider">Existing
            Identity? Connect</a>
        </div>

        <button type="submit" id="register-button" class="auth-btn">
          <span>Finalize Protocol</span>
          <i data-lucide="shield-check" class="w-5 h-5"></i>
        </button>
      </form>
    </div>
  </div>

  <div id="message-container"></div>

  <script>
    // --- 3D Background Logic ---
    const container = document.getElementById('canvas-container');
    const scene = new THREE.Scene();
    scene.fog = new THREE.FogExp2(0x050510, 0.001);

    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 3000);
    camera.position.z = 1000;

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    container.appendChild(renderer.domElement);

    function getTexture() {
      const canvas = document.createElement('canvas');
      canvas.width = 32; canvas.height = 32;
      const context = canvas.getContext('2d');
      const gradient = context.createRadialGradient(16, 16, 0, 16, 16, 16);
      gradient.addColorStop(0, 'rgba(255,255,255,1)');
      gradient.addColorStop(0.2, 'rgba(255,255,255,0.8)');
      gradient.addColorStop(0.5, 'rgba(255,255,255,0.2)');
      gradient.addColorStop(1, 'rgba(0,0,0,0)');
      context.fillStyle = gradient; context.fillRect(0, 0, 32, 32);
      const texture = new THREE.Texture(canvas); texture.needsUpdate = true; return texture;
    }
    const particleTexture = getTexture();

    const starGeo = new THREE.BufferGeometry();
    const starCount = 6000; const starPos = [];
    for (let i = 0; i < starCount; i++) { starPos.push((Math.random() - 0.5) * 3000, (Math.random() - 0.5) * 3000, (Math.random() - 0.5) * 3000); }
    starGeo.setAttribute('position', new THREE.Float32BufferAttribute(starPos, 3));
    const stars = new THREE.Points(starGeo, new THREE.PointsMaterial({ color: 0xffffff, size: 1.5, sizeAttenuation: false, transparent: true, opacity: 0.8 }));
    scene.add(stars);

    const dustGeo = new THREE.BufferGeometry();
    const dustCount = 2000; const dustPos = []; const dustColors = [];
    const colorPalette = [new THREE.Color('#ea580c'), new THREE.Color('#3b82f6'), new THREE.Color('#ffffff')];
    for (let i = 0; i < dustCount; i++) {
      dustPos.push((Math.random() - 0.5) * 2500, (Math.random() - 0.5) * 2500, (Math.random() - 0.5) * 2500);
      const color = colorPalette[Math.floor(Math.random() * colorPalette.length)];
      dustColors.push(color.r, color.g, color.b);
    }
    dustGeo.setAttribute('position', new THREE.Float32BufferAttribute(dustPos, 3));
    dustGeo.setAttribute('color', new THREE.Float32BufferAttribute(dustColors, 3));
    const dust = new THREE.Points(dustGeo, new THREE.PointsMaterial({ size: 4, map: particleTexture, vertexColors: true, transparent: true, opacity: 0.6, depthWrite: false, blending: THREE.AdditiveBlending }));
    scene.add(dust);

    let mouseX = 0, mouseY = 0;
    document.addEventListener('mousemove', (e) => {
      mouseX = (e.clientX - window.innerWidth / 2); mouseY = (e.clientY - window.innerHeight / 2);
      const card = document.querySelector('.tilt-element');
      if (card) {
        const xAxis = (window.innerWidth / 2 - e.pageX) / 40;
        const yAxis = (window.innerHeight / 2 - e.pageY) / 40;
        card.style.transform = `rotateY(${xAxis}deg) rotateX(${yAxis}deg)`;
      }
    });

    function animate() {
      requestAnimationFrame(animate);
      stars.rotation.y += 0.0001; dust.rotation.y += 0.0003;
      camera.position.x += (mouseX * 0.2 - camera.position.x) * 0.02;
      camera.position.y += (-mouseY * 0.2 - camera.position.y) * 0.02;
      camera.lookAt(scene.position); renderer.render(scene, camera);
    }
    animate();

    window.addEventListener('resize', () => { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });

    // Registration Logic
    function checkLayoutReady() {
      if (typeof window.showMessage !== 'function' || typeof window.API_BASE_URL === 'undefined') { setTimeout(checkLayoutReady, 50); return; }
      const registerForm = document.getElementById('register-form');
      const registerButton = document.getElementById('register-button');
      const btnText = registerButton.querySelector('span');

      if (window.isLoggedIn()) { window.location.href = 'account.html'; return; }

      registerForm.addEventListener('submit', async function (e) {
        e.preventDefault();
        const username = document.getElementById('username').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;

        if (password.length < 8) { window.showMessage('error', 'Key must be at least 8 characters.'); return; }

        registerButton.disabled = true; btnText.textContent = 'Initializing...';

        try {
          const response = await fetch(`${window.API_BASE_URL}/auth/register`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, email, password }),
          });
          const data = await response.json();
          if (response.ok) {
            window.showMessage('success', 'Identity Created! Granting Access...');
            localStorage.setItem('tt_token', data.token);
            setTimeout(() => { window.location.href = 'index.html'; }, 1500);
          } else {
            window.showMessage('error', data.message || 'Initiation failed.');
            registerButton.disabled = false; btnText.textContent = 'Finalize Protocol';
          }
        } catch (err) {
          window.showMessage('error', 'Network error. Protocol Interrupted.');
          registerButton.disabled = false; btnText.textContent = 'Finalize Protocol';
        }
      });
    }
    window.addEventListener('load', () => { checkLayoutReady(); lucide.createIcons(); });
  </script>
</body>

</html>